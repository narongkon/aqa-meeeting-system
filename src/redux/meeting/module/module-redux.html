<script>
    Nylon.addReducer('meeting_module', function (state, action) {
        state = state || {
            select: {
                date_start_module: '2017-01-01',
                date_end_module: '2017-01-01'
            },
            active: false
        }

        switch (action.type) {
            case 'MODULE_GET_MEETING':
                state.meeting = action.payload
                return state
                break;
            case 'MODULE_GET_REGION':
                state.region = action.payload
                return state
                break;
            case 'MODULE_GET_DATA':
                state.data = action.payload
                return state
                break;
            case 'MODULE_SELECT_DATA':
                state.select = action.payload
                return state
                break;
            case 'MODULE_GET_INVITE':
                state.invite = action.payload
                break;
            case 'MODULE_GET_PARTICIPANT':
                state.participant = action.payload
                return state
                break;
            case 'MODULE_GET_PEOPLE':
                state.people = action.payload
                return state
                break;
            case 'MODULE_ACTIVE':
                state.active = action.payload
                return state
                break;
            default:
                return state
                break;
        }
        return state
    })


    Nylon.addAction({
        view2Con: function (arg1) {
            return { type: arg1 }
        },
        meetingModuleGetMeeting: function (id) {
            return dispatch => {
                axios.get(`/meeting/module/getMeeting/${id}`).then(
                    res => {
                        dispatch({ type: 'MODULE_GET_MEETING', payload: res.data })
                    }
                )
            }
        },
        meetingModuleGetRegion: function (id) {
            return dispatch => {
                axios.get(`/meeting/module/getRegion`).then(
                    res => {
                        dispatch({ type: 'MODULE_GET_REGION', payload: res.data })
                    }
                )
            }
        },
        meetingModuleAddData: function (data) {
            var progress = Nylon.$['page-module'].$.manage_module.$.setting_module.$.pc2.progress()
            return dispatch => {
                axios.post('/meeting/module', data).then(
                    res => {
                        Nylon.dispatch('meetingModuleGetData', data.meeting_id)
                        progress(_ => {

                            Nylon.$['page-module'].$.manage_module.$.pr.close()

                            Nylon.toast({
                                msg: 'เพิ่มเสร็จสิ้น'
                            })
                        })

                    }
                )
            }
        },
        meetingModuleGetData: function (id) {

            var progress = Nylon.$['page-module'].$.list_module.$.pc1.progress({ position: 'top' })
            return dispatch => {
                axios.get(`/meeting/module/getData/${id}`).then(
                    res => {
                        progress(() => {
                            dispatch({ type: 'MODULE_GET_DATA', payload: res.data })
                        })
                    }
                )
            }
        },
        meetingModuleSelectData: function (id) {
            return dispatch => {
                // console.log(Nylon.store.getState().meeting_module.region)
                axios.get(`/meeting/module/selectData/${id}`).then(
                    res => {

                        var date_start = res.data.date_start_module.split("T");
                        res.data.date_start_module = date_start[0]
                        var date_end = res.data.date_end_module.split("T");
                        res.data.date_end_module = date_end[0]

                        dispatch({ type: 'MODULE_SELECT_DATA', payload: res.data })
                        Nylon.$['page-module'].$.manage_module.$.pr.open()
                    }
                )
            }
        },
        meetingModuleDelData: function (data) {
            return dispatch => {
                axios.delete(`/meeting/module/${data.id}`).then(
                    res => {
                        Nylon.dispatch('meetingModuleGetData', data.meeting_id)
                    }
                )
            }
        },
        meetingModuleEditData: function (data) {
            var progress = Nylon.$['page-module'].$.manage_module.$.setting_module.$.pc2.progress()
            return dispatch => {
                axios.put('/meeting/module', data).then(
                    res => {
                        Nylon.dispatch('meetingModuleGetData', data.meeting_id)
                        progress(_ => {

                            Nylon.$['page-module'].$.manage_module.$.pr.close()

                            Nylon.toast({
                                msg: 'แก้ไขเสร็จสิ้น'
                            })
                        })

                    }
                )
            }
        },
        meetingModuleGetInvite: function (id) {
            return dispatch => {
                axios.get(`/meeting/module/getInvite/${id}`).then(
                    res => {
                        dispatch({ type: 'MODULE_GET_INVITE', payload: res.data })
                    }
                )
            }
        },
        meetingModuleGetParticipant: function (id) {
            return dispatch => {
                axios.get(`/meeting/module/getParticipant/${id}`).then(
                    res => {
                        dispatch({ type: 'MODULE_GET_PARTICIPANT', payload: res.data })
                    }
                )
            }
        },
        meetingModuleGetPeople: function (id) {
            return dispatch => {
                axios.get(`/meeting/module/getPeople/${id}`).then(
                    res => {
                        dispatch({ type: 'MODULE_GET_PEOPLE', payload: res.data })
                    }
                )
            }
        },
        meetingModuleAddInvite: function (data, id) {
            let invite = {
                profile: data,
                module_id: id
            }
            // console.log(data)
            return dispatch => {
                dispatch({ type: 'MODULE_ACTIVE', payload: true })
                axios.post('/meeting/module/addInvite', invite).then(
                    res => {
                        dispatch({ type: 'MODULE_ACTIVE', payload: false })
                        Nylon.dispatch('meetingModuleGetPeople', id)
                        Nylon.dispatch('meetingModuleGetInvite', id)
                    }
                )
            }
        },
        meetingModuleDelInvite: function (data, id) {
            return dispatch => {
                axios.put('/meeting/module/delInvite', data).then(
                    res => {
                        Nylon.dispatch('meetingModuleGetPeople', id)
                        Nylon.dispatch('meetingModuleGetInvite', id)
                    }
                )
            }
        },
        meetingModuleEditInvite: function (data, id) {
            return dispatch => {
                axios.put('/meeting/module/editInvite', data).then(
                    res => {
                        Nylon.dispatch('meetingModuleGetPeople', id)
                        Nylon.dispatch('meetingModuleGetInvite', id)
                    }
                )
            }
        },
    })

</script>