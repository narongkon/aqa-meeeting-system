<script>
    Nylon.addReducer('expenses_module', function (state, action) {
        state = state || {
            select: {
                date_start_module: '2017-01-01',
                date_end_module: '2017-01-01'
            }
        }

        switch (action.type) {
            case 'EXPENSES_MODULE_GET_MEETING':
                state.meeting = action.payload
                return state
                break;
            case 'EXPENSES_MODULE_GET_REGION':
                state.region = action.payload
                return state
                break;
            case 'EXPENSES_MODULE_GET_DATA':
                state.data = action.payload
                return state
                break;
            case 'EXPENSES_MODULE_SELECT_DATA':
                state.select = action.payload
                return state
                break;
            case 'EXPENSES_MODULE_GET_INVITE':
                state.invite = action.payload
                break;
            case 'EXPENSES_MODULE_GET_PARTICIPANT':
                state.participant = action.payload
                return state
                break;
            case 'EXPENSES_MODULE_GET_PEOPLE':
                state.people = action.payload
                return state
                break;
            default:
                return state
                break;
        }
        return state
    })


    Nylon.addAction({
        view2Con: function (arg1) {
            return { type: arg1 }
        },
        expensesModuleGetMeeting: function (id) {
            return dispatch => {
                axios.get(`/meeting/module/getMeeting/${id}`).then(
                    res => {
                        dispatch({ type: 'EXPENSES_MODULE_GET_MEETING', payload: res.data })
                    }
                )
            }
        },
        expensesModuleGetRegion: function (id) {
            return dispatch => {
                axios.get(`/meeting/module/getRegion`).then(
                    res => {
                        dispatch({ type: 'EXPENSES_MODULE_GET_REGION', payload: res.data })
                    }
                )
            }
        },
        expensesModuleAddData: function (data) {
            var progress = Nylon.$['page-meeting-module'].$.manage_module.$.setting_module.$.pc2.progress()
            return dispatch => {
                axios.post('/meeting/module', data).then(
                    res => {
                        Nylon.dispatch('expensesModuleGetData', data.meeting_id)
                        progress(_ => {

                            Nylon.$['page-meeting-module'].$.manage_module.$.pr.close()

                            Nylon.toast({
                                msg: 'เพิ่มเสร็จสิ้น'
                            })
                        })

                    }
                )
            }
        },
        expensesModuleGetData: function (id) {

            var progress = Nylon.$['page-expenses-module'].$.list_module.$.pc1.progress({ position: 'top' })
            return dispatch => {
                axios.get(`/meeting/module/getData/${id}`).then(
                    res => {
                        progress(() => {
                            dispatch({ type: 'EXPENSES_MODULE_GET_DATA', payload: res.data })
                        })
                    }
                )
            }
        },
        expensesModuleSelectData: function (id) {
            console.log('select')
            return dispatch => {
                axios.get(`/meeting/module/selectData/${id}`).then(
                    res => {

                        var date_start = res.data.date_start_module.split("T");
                        res.data.date_start_module = date_start[0]
                        var date_end = res.data.date_end_module.split("T");
                        res.data.date_end_module = date_end[0]

                        dispatch({ type: 'EXPENSES_MODULE_SELECT_DATA', payload: res.data })
                        Nylon.$['page-meeting-module'].$.manage_module.$.pr.open()
                    }
                )
            }
        },
        expensesModuleDelData: function (data) {
            return dispatch => {
                axios.delete(`/meeting/module/${data.id}`).then(
                    res => {
                        Nylon.dispatch('expensesModuleGetData', data.meeting_id)
                    }
                )
            }
        },
        expensesModuleEditData: function (data) {
            var progress = Nylon.$['page-meeting-module'].$.manage_module.$.setting_module.$.pc2.progress()
            return dispatch => {
                axios.put('/meeting/module', data).then(
                    res => {
                        Nylon.dispatch('expensesModuleGetData', data.meeting_id)
                        progress(_ => {

                            Nylon.$['page-meeting-module'].$.manage_module.$.pr.close()

                            Nylon.toast({
                                msg: 'แก้ไขเสร็จสิ้น'
                            })
                        })

                    }
                )
            }
        },
        expensesModuleGetInvite: function (id) {
            return dispatch => {
                axios.get(`/meeting/module/getInvite/${id}`).then(
                    res => {
                        dispatch({ type: 'EXPENSES_MODULE_GET_INVITE', payload: res.data })
                    }
                )
            }
        },
        expensesModuleGetParticipant: function (id) {
            return dispatch => {
                axios.get(`/meeting/module/getParticipant/${id}`).then(
                    res => {
                        dispatch({ type: 'MEETING_MODULE_GET_PARTICIPANT', payload: res.data })
                    }
                )
            }
        },
        expensesModuleGetPeople: function (id) {
            return dispatch => {
                axios.get(`/meeting/module/getPeople/${id}`).then(
                    res => {
                        console.log(res.data)
                        dispatch({ type: 'MEETING_MODULE_GET_PEOPLE', payload: res.data })
                    }
                )
            }
        }
    })

</script>