<link rel="import" href="../../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../components/nylon-panel-card/nylon-panel-card.html">
<link rel="import" href="../../../../bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="../../../../bower_components/vaadin-grid/vaadin-grid-column.html">
<link rel="import" href="../../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="../../../redux-mixin.html">

<dom-module id="page-list-material">
    <template>
        <style include="shared-styles">
             :host {
                display: block;
            }

            .font {
                font-family: 'CSChatThaiUI', 'tahoma', sans-serif;
                -webkit-font-smoothing: antialiased;
            }
        </style>
        <nylon-panel-card id="pc1" style="margin-top: 0.5cm;">
            <app-toolbar slot="header">
                <div main-title>ค่าวัสดุอุปกรณ์</div>
                <paper-button raised class="btn-primary font" on-click="_openPanelRight">
                    <iron-icon icon="add-circle-outline"></iron-icon>&nbsp;&nbsp;เพิ่ม
                </paper-button>
            </app-toolbar>
            <vaadin-grid slot="content" sub-slot="grid" items="[[expenses]]">
                <vaadin-grid-column width="80px" flex-grow="0">
                    <template class="header"></template>
                    <template> [[_index(index)]] </template>
                </vaadin-grid-column>
                <vaadin-grid-column>
                    <template class="header">รายการ</template>
                    <template>[[item.expense_name]]</template>
                </vaadin-grid-column>
                <vaadin-grid-column>
                    <template class="header">จำนวน</template>
                    <template>[[item.expense_amount]]</template>
                </vaadin-grid-column>
                <vaadin-grid-column>
                    <template class="header">ราคา (บาท)</template>
                    <template>[[item.expense_price]]</template>
                </vaadin-grid-column>
                <vaadin-grid-column>
                    <template class="header">รวม (บาท)</template>
                    <template>[[_sum(item.expense_amount,item.expense_price)]]</template>
                </vaadin-grid-column>
                <vaadin-grid-column>
                    <template class="header">จัดการ</template>
                    <template>
                        <div>
                            <paper-icon-button icon="create" on-click="_selectData"></paper-icon-button>
                            <paper-icon-button icon="delete" on-click="_delData"></paper-icon-button>
                        </div>

                    </template>
                </vaadin-grid-column>
            </vaadin-grid>
        </nylon-panel-card>
    </template>

    <script>
        class pageListMaterial extends ReduxMixin(Polymer.Element) {

            static get is() {
                return 'page-list-material';
            }

            static get properties() {
                return {
                    data: {
                        type: Object,
                        statePath: 'expenses_cost.data',
                        observer: '_data_change'
                    },
                    expenses: {
                        type: Object
                    }
                };
            }

            ready() {
                super.ready();

                Polymer.RenderStatus.afterNextRender(this, function () {

                });
            }

            _sum(price, amount) {
                return price * amount
            }

            _data_change(e) {
                console.log(e)
                for (var x in e) {
                    if (e[x].group == 1) {
                        console.log(e[x].reduction)
                        this.set('expenses', e[x].reduction)
                    }
                }
            }

            _index(i) {
                return i + 1;
            }

            _openPanelRight() {
                Nylon.$['page-expenses-cost'].$.manage_material.data = { expense_amount: 1, expense_price: 1 };
                Nylon.$['page-expenses-cost'].$.manage_material.$.pr.open()
            }

            _selectData(e) {
                Nylon.dispatch('expensesCostSelectData', e.model.item.id)
            }

            _delData(e) {
                Nylon.dispatch('expensesCostDelData', e.model.item)
            }
        }

        window.customElements.define(pageListMaterial.is, pageListMaterial);
    </script>
</dom-module>